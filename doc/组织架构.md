# 组织架构
-----
## 功能描述
- 提供组织机构的查询和修改
- 组织架构变化支持订阅和发布

## 性能和扩展性要求
- 读写都复杂
- 能够扩展
- 读的频率更多

## 领域模型（待完成）
- Org
	- id
	- name
	- departments
	- members
	  
- Department
- SubOrg
- Employee

以`Org`作为聚合根


## API（待完成）

## 参考CQRS / EventSourcing 架构模式
`CQRS`的介绍网上有许多，这里采用微软MSDN上的文档：
链接如下：

[Command and Query Responsibility Segregation (CQRS) Pattern](https://msdn.microsoft.com/en-us/library/dn568103.aspx)

CQRS有好几种变种，例如这份文档就给出两种：

`Figure 2` 这种读写模式共享数据库。在代码层面，将读和写的逻辑剥离，好处是能够降低业务处理的复杂度。

`Figure 3` 这种模式是分离了读库和写库，这种模式，`读库`（`WriteDB`）和`写库`(`ReadDB`)分开部署，可以部署不通的数据（`NoSQL`+`RDBMS`可以混合部署），扩展性好。读和写的差异更大。

![](/opt/mos/codebase/org-design/doc/cqrs3.png =700x350)
![](/opt/mos/codebase/org-design/doc/cqrs1.png =700x300)

后一种模式，完整的CQRS架构如下。在JVM平台上，大部分组件都是现成的，并且使用比较广泛。
![](/opt/mos/codebase/org-design/doc/cqrs2.png =700x400)

## 并发，Actor模型和AKKA
并发处理方面，有个比较成熟的`Actor模型`（JVM平台上）， `akka`。

这个`akka`对于我们来说有几个优势：

- 很好的并发。`akka`官网宣布的性能是

```
50 million msg/sec on a single machine. Small memory footprint; ~2.5 million actors per GB of heap.
```

- `Actor`也是比较熟悉的模型（不过以前是`Erlang`的Actor模型）
- akka有个组件，叫做 `persistence`,这种方式实现EventSourcing和CQRS比较自然。

## 性能模型

### 写入性能分析
总得代价为校验加上事件发布的代价。

- 校验
- 事件（日志-leveldb\cassandra(LSM)）
	- `DepartmentDisabled`
	- `DepartmentMoved`
	- `EmpleeJoined`
	- .. 

### 读取性能评估

### 数据量

#### 子部门数据量查询表

第一列是平均每个部门的`子部门数`，其他列为对应的`部门层级`时的全公司的`总部门数目`。

| sub deps | level 1 | level 2 | level 3 | level 4   | level 5     | level 6       | level 7         | level 8           | level 9             | level 10              |
| :--:     | :--:    | :--:    | :--:    | :--:      | :--:        | :--:          | :--:            | :--:              | :--:                | :--:                  |
| 2        | `3`     | `7`     | `15`    | `31`      | `63`        | `127`         | `255`           | `511`             | `1023`              | `2047`                |
| 3        | `4`     | `13`    | `40`    | `121`     | `364`       | `1093`        | `3280`          | `9841`            | `29524`             | `88573`               |
| 4        | `5`     | `21`    | `85`    | `341`     | `1365`      | `5461`        | `21845`         | `87381`           | 349525              | 1398101               |
| 5        | `6`     | `31`    | `156`   | `781`     | `3906`      | `19531`       | `97656`         | 488281            | 2441406             | 12207031              |
| 6        | `7`     | `43`    | `259`   | `1555`    | `9331`      | `55987`       | 335923          | 2015539           | 12093235            | 72559411              |
| 7        | `8`     | `57`    | `400`   | `2801`    | `19608`     | 137257        | 960800          | 6725601           | 47079208            | 329554457             |
| 8        | `9`     | `73`    | `585`   | `4681`    | `37449`     | 299593        | 2396745         | 19173961          | 153391689           | 1227133513            |
| 9        | `10`    | `91`    | `820`   | `7381`    | `66430`     | 597871        | 5380840         | 48427561          | 435848050           | 3922632451            |
| 10       | `11`    | `111`   | `1111`  | `11111`   | 111111      | 1111111       | 11111111        | 111111111         | 1111111111          | 11111111111           |
| 15       | `16`    | `241`   | `3616`  | `54241`   | 813616      | 12204241      | 183063616       | 2745954241        | 41189313616         | 617839704241          |
| 20       | `21`    | `421`   | `8421`  | 168421    | 3368421     | 67368421      | 1347368421      | 26947368421       | 538947368421        | 10778947368421        |
| 50       | `51`    | `2551`  | 127551  | 6377551   | 318877551   | 15943877551   | 797193877551    | 39859693877551    | 1992984693877551    | 99649234693877551     |
| 100      | `101`   | `10101` | 1010101 | 101010101 | 10101010101 | 1010101010101 | 101010101010101 | 10101010101010101 | 1010101010101010101 | 101010101010101010101 |




#### 组织架构的修改

| 操作     | 频率 | 难度  | 难点               |
| :--:     | :--: | :--:  | :--:               |
| 创建组织 | 中   | ★★    |                    |
| 创建部门 | 高   | ★     |                    |
| 新增员工 | 高   | ★     |                    |
| 删除员工 | 低   | ★     |                    |
| 删除部门 | 低   | ★★★   | 中间数据的正确维护 |
| 移动部门 | 中   | ★★★★★ | 中间数据的正确维护 |


#### 组织架构的查询

| 查询                     | 频率 | 难度  | 难点 |
| :--:                     | :--: | :--:  | :--: |
| 单个部门信息             | 高   | ★     |      |
| 单个员工信息             | 高   | ★     |      |
| 单个部门员工集合         | 高   | ★     |      |
| 查询一个员工直属的子公司 | 高   | ★★    |      |
| 满足特定条件的岗位员工   | 低   | ★★★   |      |
| 父部门                   | 中   | ★     |      |
| 祖先部门                 | 中   | ★★★   |      |
| 直属子部门               | 中   | ★     |      |
| 所有子部门               | 高   | ★★★★  | 效率 |
| 所有子部门员工           | 中   | ★★★★★ | 效率 |
| 数据的全量导出           | 低   | ★★★★★ | 效率 |

#### 注意事项
- 高频API的调用考虑到效率，不宜与数据库交互次数太多（多次查询）。
  
  
  
#### 单`记录`内存信息占用评估
=======
| Entity   | 数目 | 单位内存占用 | 主要占用 |
| :--:     | :--: | :--:         | :--:     |
| 组织     | 少   | 2K           | 字段多   |
| 部门     | 中   | 2K           | 字段多   |
| 员工     | 多   | 1K           | 字段多   |
| 岗位     | 少   | 1K           |          |
| 隶属关系 | 多   | 128字节      | ID占用   |

#### 查询优化设计
======

##### 用`关系模型`表示`树模型`

整改组织的架构可以用树状结构来表示。

```
矩阵结构原则上也可以用同一个组织下两棵对等的组织树来表示。
```

###### ID/PID设计

最常用的方式是`id/pid`的设计方式。这种方式对所有RDBMS都适用。我们以前也是采用这种方式：`组织结构人员关系`表(即`Core_OrgOUEmployeeMap`)这张表，就是这种方式。

新的组织关系表(`org_tree`)设计如下：

| 字段        | 类型   | 意义                                |
| :--:        | :--:   | :--:                                |
| node_id     | 字符串 | 节点的ID                            |
| node_type   | Enum   | 节点类型:部门，子公司，项目组，员工 |
| parent_id   | 字符串 | 父亲节点的类型                      |
| parent_type | Enum   | 节点类型:子公司，项目组，部门       |

注意:

+ `顶级部门`的`parent_id`为其自己的ID，不采用`NULL`,确保表里的字段都满足外键约束。
+ 这里的隶属关系不再像原来的表，只能表示**`人员`与`部门`的隶属关系**，这里的表能够表示:
**所有`实体`之间的`隶属`关系**,
例如：人员隶属某个部门，部门隶属某个子公司等等都在这张表里。

与原来的表结构做了如下改动：

- 删除了`IsPartTime`(`是否兼职`)这个字段。原因，我们新的组织架构需要支持在多个部门的场景，所以这个可以拿掉。
- `IsManager`(`是否是主管`)字段暂时不添加进来，移动的其他的表。主要考虑是尽量减少字段数目，减少表大小。原来的字段类型为`BIT`,在MySQL等数据库中，还是[`1字节`](http://dev.mysql.com/doc/refman/5.7/en/storage-requirements.html)(BIT(M)大约占用(M+7)/8字节),Oracle里可能比较高效。

###### 其他已知的方式

调研发现，有企业使用json存储组织架构关系，放到支持json查询的数据库里（例如postgres）。没有仔细研究过，怎么使用的。暂时不做考虑。

##### 查询加速

基于上述的表结构，再结合我们的查询操作，我们来考虑查询的效率问题。
可以看出有部分查询不太高效，例如：

- 查询一个部门的所有子(父)部门
- 查询一个员工直属的子公司

这些查询，使用`隶属表`（`org_tree`），则不太高效。例如：

```
查询一个部门的所有子孙部门的人员列表
```

为了完成这个查询，我们普通的方法是：

```
1. 递归的查询出当前部门的所有子孙部门
2. 查出所有隶属与这些部门的员工
```

其中，***步骤1***涉及多次调用，每个部门平均5个子部门，共4层，则共需要`1+5+25=31`次查询。数据量不大，但是调用太多，总的操作时间会比较长。所以实际中不能采用这种方式。

###### 解决方案

设计冗余的检索信息结构。保存在数据库或者内存里。在查询这类信息时，用这种结构做检索，再辅助隶属表。

这个查询，可以分下面两个阶段的`查询计划`

```
1. 从检索结构中查出相关的拓扑关系（例如，子部门ID）
2. SQL查询（例如, select * from employee where department_id in (子部门id列表)）
```
如果这个检索设计在数据库里，则可以进一步简化为一个SQL查询（通过子查询）：

```
1. SQL查询（例如, select * from employee where department_id in (子部门id列表查询SQL)）
```

### 部门拓扑关系高效查询的可能方式有
#### 内存建模
在内存中自己维护这个拓扑关系。这里需要注意内存的使用，**防止使用过多的内存**。

可以有下面的一些措施减少内存占用：

-  `succinct`信息结构
-  定期失效，移除内存

#### `neo4j`等图数据存储拓扑关系
使用图数据库来维护这个关系。

#### 数据库冗余

用RDBMS加速查询优化，主要参考:

======


[Representing Trees in a relational DB](http://fungus.teststation.com/~jon/treehandling/TreeHandling.htm) 


url: http://fungus.teststation.com/~jon/treehandling/TreeHandling.htm

###### `path`表的数目

| sub deps | level 1 | level 2 | level 3 | level 4   | level 5     | level 6       | level 7         | level 8           | level 9             | level 10               |
| :--:     | :--:    | :--:    | :--:    | :--:      | :--:        | :--:          | :--:            | :--:              | :--:                | :--:                   |
| `2`      | `3`     | `17`    | `62`    | `186`     | `501`       | `1263`        | `3048`          | `7136`            | `16343`             | `36813`                |
| `3`      | `4`     | `30`    | `150`   | `634`     | `2454`      | `9012`        | `31972`         | `110700`          | `376416`            | `1262146`              |
| `4`      | `5`     | `47`    | `302`   | `1666`    | `8491`      | `41257`       | `194172`        | `893220`          | 4038945             | 18019955               |
| `5`      | `6`     | `68`    | `536`   | `3660`    | `23190`     | `140376`      | `823968`        | 4730216           | 26702870            | 148773180              |
| `6`      | `7`     | `93`    | `870`   | `7090`    | `53745`     | `389667`      | 2741128         | 18865440          | 127704555           | 853298665              |
| `7`      | `8`     | `122`   | `1322`  | `12526`   | `110566`    | 934108        | 7659708         | 61464516          | 485177388           | 3780721958             |
| `8`      | `9`     | `155`   | `1910`  | `20634`   | `207879`    | 2005437       | 18782652        | 172174340         | 1552699541          | 13824034671            |
| `9`      | `10`    | `192`   | `2652`  | `32176`   | `364326`    | 3951552       | 41617432        | 429037920         | 4351670370          | 43577994880            |
| `10`     | `11`    | `233`   | `3566`  | `48010`   | 603565      | 7270231       | 85048008        | 973936896         | 10973936895         | 122085048005           |
| `15`     | `16`    | `498`   | `11346` | `228310`  | 4296390     | 77521836      | 1358967148      | 23326601076       | 394030423620        | 6572427466030          |
| `20`     | `21`    | `863`   | `26126` | 699810    | 17541915    | 421752441     | 9853331388      | 225432278756      | 5075958594545       | 112865432278755        |
| `50`     | `51`    | `5153`  | 387806  | 25898010  | 1620285765  | 97283551071   | 5677640693928   | 324555191714336   | 18261417436612295   | 1014753764375387805    |
| `100`    | `101`   | `20303` | 3050606 | 407091010 | 50912141515 | 6111518202121 | 713182225272828 | 81521263033353636 | 9172430353942444545 | 1019273440454952545555 |

###### 移动部门`path`表移动的数目

| sub deps | level 1 | level 2 | level 3 | level 4 | level 5   | level 6     | level 7       | level 8         | level 9           | level 10            |
| :--:     | :--:    | :--:    | :--:    | :--:    | :--:      | :--:        | :--:          | :--:            | :--:              | :--:                |
| `2`      | `1`     | `3`     | `7`     | `15`    | `31`      | `63`        | `127`         | `255`           | `511`             | `1023`              |
| `3`      | `1`     | `4`     | `13`    | `40`    | `121`     | `364`       | `1093`        | `3280`          | `9841`            | `29524`             |
| `4`      | `1`     | `5`     | `21`    | `85`    | `341`     | `1365`      | `5461`        | `21845`         | 87381             | 349525              |
| `5`      | `1`     | `6`     | `31`    | `156`   | `781`     | `3906`      | `19531`       | 97656           | 488281            | 2441406             |
| `6`      | `1`     | `7`     | `43`    | `259`   | `1555`    | `9331`      | 55987         | 335923          | 2015539           | 12093235            |
| `7`      | `1`     | `8`     | `57`    | `400`   | `2801`    | 19608       | 137257        | 960800          | 6725601           | 47079208            |
| `8`      | `1`     | `9`     | `73`    | `585`   | `4681`    | 37449       | 299593        | 2396745         | 19173961          | 153391689           |
| `9`      | `1`     | `10`    | `91`    | `820`   | `7381`    | 66430       | 597871        | 5380840         | 48427561          | 435848050           |
| `10`     | `1`     | `11`    | `111`   | `1111`  | 11111     | 111111      | 1111111       | 11111111        | 111111111         | 1111111111          |
| `15`     | `1`     | `16`    | `241`   | `3616`  | 54241     | 813616      | 12204241      | 183063616       | 2745954241        | 41189313616         |
| `20`     | `1`     | `21`    | `421`   | 8421    | 168421    | 3368421     | 67368421      | 1347368421      | 26947368421       | 538947368421        |
| `50`     | `1`     | `51`    | 2551    | 127551  | 6377551   | 318877551   | 15943877551   | 797193877551    | 39859693877551    | 1992984693877551    |
| `100`    | `1`     | `101`   | 10101   | 1010101 | 101010101 | 10101010101 | 1010101010101 | 101010101010101 | 10101010101010101 | 1010101010101010101 |


====

[Tree In Sql](http://c2.com/cgi/wiki?TreeInSql)


url: http://c2.com/cgi/wiki?TreeInSql


#  数据切分

以公司做水平划分。需要避免跨公司查询。

## 读表结构


=======
member

| Attribute/Logical Rolename | Domain     | Datatype      | NULL | Definition                                                          |
| :--:                       | :--:       | :--:          | :--: | :--:                                                                |
| ID(PK)                     | 主键ID     | CHAR(36)      | NO   | 用户登录用户名，与Membership一对一关系                              |
| OrgID                      | 外键ID     | CHAR(36)      | YES  | 机构ID                                                              |
| UserName                   | 编号       | NVARCHAR(50)  | NO   | 用户名                                                              |
| CnName                     | 名称       | NVARCHAR(50)  | NO   | 用户中文名称                                                        |
| HeadPictureURL             | 页面路径   | NVARCHAR(500) | YES  | 用户头像，引用表图库表                                              |
| Email                      | 页面路径   | NVARCHAR(500) | YES  | 页面路径                                                            |
| Mobile                     | 编号       | NVARCHAR(50)  | NO   | 手机                                                                |
| UserNo                     | 编号       | NVARCHAR(50)  | YES  | 员工编号(相当于警号、员工工号)                                      |
| SignName                   | 文本100    | NVARCHAR(100) | YES  | 用户个性化签名                                                      |
| Sex                        | 名称       | NVARCHAR(50)  | YES  | 性别，F-女　M-男:空字符（""）表示不确定                             |
| Birthday                   | 日期       | DATE          | YES  | 出生年月                                                            |
| UserClassLevelID           | 外键ID     | CHAR(36)      | YES  | 用户等级ID                                                          |
| UserClassLevelNo           | 整型       | INTEGER       | NO   | 用户当前的级别编号                                                  |
| UserClassLevelName         | 名称       | NVARCHAR(50)  | NO   | 姓名名称                                                            |
| UserClassLevelImageUrl     | 页面路径   | NVARCHAR(500) | YES  | 用户等级对应的图片地址                                              |
| UserAppFeatureGroupID      | 编号       | NVARCHAR(50)  | NO   | 菜单组ID                                                            |
| PersonalSign               | 简介备注   | NVARCHAR(400) | YES  | 个人介绍                                                            |
| CurrentPositionID          | 外键ID     | CHAR(36)      | YES  | 当前职位ID                                                          |
| IsRecommend                | 整型       | INTEGER       | NO   | 数量                                                                |
| CurrentPositionName        | 名称       | NVARCHAR(50)  | NO   | 当前职位名称                                                        |
| DepartmentID               | 外键ID     | CHAR(36)      | YES  | 前用户所有部门的ID(主要部门，非兼职部门）                           |
| DepartmentName             | 名称       | NVARCHAR(50)  | YES  | 所在部门的名称（非兼职部门)                                         |
| Status                     | 枚举型     | NVARCHAR(50)  | NO   | 用户状态：用于标识当前用户的状态，0表示禁用                         |
| JobName                    | 名称       | NVARCHAR(50)  | YES  | 职务名称                                                            |
| BelongDepartmentID         | 外键ID     | CHAR(36)      | YES  | 所属一级部门ID                                                      |
| BelongDepartmentName       | 名称       | NVARCHAR(50)  | YES  | 所属一级部门名称                                                    |
| ThirdSystemUserNo          | 编号       | NVARCHAR(50)  | YES  | 第三方系统用户账号                                                  |
| ThirdSystemSyncDate        | 创建日期   | DATE          | YES  | 第三方同步时间                                                      |
| ThirdSystemType            | 枚举型     | NVARCHAR(50)  | YES  | ThirdSystemType,第三方系统类型:AD AD;                               |
| MsgSubscribeType           | 枚举型     | NVARCHAR(50)  | YES  | 消息订阅提醒方式，由枚举UserMsgSubscribeType确定                    |
| IsNew                      | 布尔型     | BIT           | NO   | 是否新员工                                                          |
| ViewUrl                    | 页面路径   | NVARCHAR(500) | YES  | 用户明细页面                                                        |
| UserIdentityType           | 整型       | INTEGER       | NO   | 用户身份类型（1：老师；0：普通身份）默认普通身份                    |
| CreateUserID               | 创建人ID   | CHAR(36)      | YES  | 创建人ID                                                            |
| CreateUserName             | 创建人名称 | NVARCHAR(50)  | YES  | 创建人名称                                                          |
| CreateDate                 | 创建日期   | DATE          | YES  | 创建日期                                                            |
| UpdateUserID               | 更新人ID   | CHAR(36)      | YES  | 更新人ID                                                            |
| UpdateUserName             | 更新人姓名 | NVARCHAR(50)  | YES  | 更新人姓名                                                          |
| UpdateDate                 | 更新日期   | DATE          | YES  | 更新日期                                                            |
| LastLoginTime              | 更新日期   | DATE          | YES  | 最后登录时间                                                        |
| IsAdmin                    | 布尔型     | BIT           | NO   | 是否管理员                                                          |
| IsEmailValidated           | 布尔型     | BIT           | NO   | 是否邮箱验证                                                        |
| IsMobileValidated          | 布尔型     | BIT           | NO   | 是否手机验证                                                        |
| IsAutonymValidated         | 布尔型     | BIT           | NO   | 是否实名验证                                                        |
| LastLoginDate              | 日期       | DATE          | YES  | 最后登录日期                                                        |
| MobileLastLoginDate        | 日期       | DATE          | YES  | 最后移动端登录日期                                                  |
| UserType                   | 枚举型     | NVARCHAR(50)  | NO   | 用户类型                                                            |
| LoweredEmail               | 文本1000   | NVARCHAR(256) | NO   | 小写Email                                                           |
| ApproveStatus              | 整型       | INTEGER       | NO   | 用户是否已认证(为0时用户无法登录)0-未审核，1-已经通过,-1-审核不通过 |
| IsLockedOut                | 布尔型     | BIT           | NO   | 用户是否已锁定（可配置密码重试次数，超过则自动锁定该用户）          |
| IsEnabled                  | 布尔型     | BIT           | NO   | 是否禁用/启用                                                       |
| IsRegisterUser             | 布尔型     | BIT           | NO   | 是否注册用户                                                        |
| OrgCode                    | 编号       | NVARCHAR(50)  | NO   | 机构编号                                                            |
| FailedPwdAttemptCount      | 整型       | INTEGER       | NO   | 密码重试次数                                                        |
| EncryptionType             | 枚举型     | NVARCHAR(50)  | NO   | 密码加密方式                                                        |
| ExpiredDate                | 日期       | DATE          | YES  | 账户有效期                                                          |
| EnableText                 | 名称       | NVARCHAR(50)  | NO   | 禁用/启用加密字符串                                                 |
| Password                   | 编号       | NVARCHAR(128) | NO   | 加密或未加密的密码                                                  |
| CreateSourceType           | 枚举型     | NVARCHAR(50)  | NO   | 创建用户类型                                                        |
| LowerUserName              | 编号       | NVARCHAR(50)  | NO   | 小写账号名                                                          |
| DeviceId                   | 编号       | NVARCHAR(100) | YES  | 设备ID                                                              |
| ClientKey                  | 编号       | NVARCHAR(50)  | YES  | 移动客户端的唯一标记，每次移动端生成新的覆盖                        |
| Spare1                     | 文本100    | NVARCHAR(400) | YES  | 备用1                                                               |
| Spare2                     | 文本100    | NVARCHAR(400) | YES  | 备用2                                                               |
| Spare3                     | 文本100    | NVARCHAR(300) | YES  | 备用3                                                               |
| Spare4                     | 文本100    | NVARCHAR(400) | YES  | 备用4                                                               |
| Spare5                     | 文本100    | NVARCHAR(400) | YES  | 备用5                                                               |
| Spare6                     | 文本100    | NVARCHAR(400) | YES  | 备用6                                                               |
| Spare7                     | 文本100    | NVARCHAR(400) | YES  | 备用7                                                               |
| Spare8                     | 文本100    | NVARCHAR(400) | YES  | 备用8                                                               |
| Spare9                     | 文本100    | NVARCHAR(400) | YES  | 备用9                                                               |
| Spare10                    | 文本100    | NVARCHAR(400) | YES  | 备用10                                                              |
| LowerCnName                | 文本100    | NVARCHAR(100) | YES  | 小写的中文名称                                                      |

=======
org

| Attribute/LogicalRolename   | Domain     | Datatype            | NULL | Definition                                                                    |
| :--:                        | :--:       | :--:                | :--: | :--:                                                                          |
| ID(PK)                      | 主键ID     | CHAR(36)            | NO   | 主键ID                                                                        |
| OrgCode                     | 编号       | NVARCHAR(50)        | NO   | 机构代码                                                                      |
| OrgName                     | 名称       | NVARCHAR(50)        | NO   | 单位名称                                                                      |
| OrgInternalNumber           | 编号       | NVARCHAR(50)        | YES  | 机构内部编号                                                                  |
| ProvinceID                  | 外键ID     | CHAR(36)            | YES  | 所在省份，引用Core_BaseInfo.ID                                                |
| ProvinceName                | 名称       | NVARCHAR(50)        | YES  | 姓名名称                                                                      |
| CityID                      | 外键ID     | CHAR(36)            | YES  | 所在城市                                                                      |
| CityName                    | 名称       | NVARCHAR(50)        | YES  | 姓名名称                                                                      |
| Email                       | 文本100    | NVARCHAR(100)       | YES  | 电子邮箱                                                                      |
| Address                     | 文本100    | NVARCHAR(100)       | YES  | 地址                                                                          |
| EstablishmentDate           | 日期       | DATE                | YES  | 机构成立日期                                                                  |
| LegalPerson                 | 名称       | NVARCHAR(50)        | YES  | 企业法人                                                                      |
| LegalPersonTelephone        | 编号       | NVARCHAR(50)        | YES  | 编号                                                                          |
| LegalNumber                 | 编号       | NVARCHAR(50)        | YES  | 法人代码                                                                      |
| OrgNatureID                 | 外键ID     | CHAR(36)            | YES  | 机构性质，引用BaseInfo的机构性质列表                                          |
| IsHasParent                 | 布尔型     | BIT                 | NO   | 是否有母公司                                                                  |
| ManageDept                  | 名称       | NVARCHAR(50)        | YES  | 主管部门                                                                      |
| ParentOrgName               | 名称       | NVARCHAR(50)        | YES  | 母公司名称                                                                    |
| ParentOrgLegalNumber        | 编号       | NVARCHAR(50)        | YES  | 母公司法人代码                                                                |
| RegisterAddress             | 文本100    | NVARCHAR(100)       | YES  | 法定注册地址                                                                  |
| RegisterFunds               | 整型       | INTEGER             | NO   | 机构注册资金(万元)                                                            |
| Postcode                    | 编号       | NVARCHAR(50)        | YES  | 机构邮编                                                                      |
| IndustryID                  | 外键ID     | CHAR(36)            | YES  | 公司行业，基本资料中Core_BaseInfo.ID                                          |
| Industry                    | 名称       | NVARCHAR(50)        | YES  | 姓名名称                                                                      |
| EmployeeScaleID             | 外键ID     | CHAR(36)            | YES  | 企业员工规模，基本资料中Core_BaseInfo.ID                                      |
| LogoURL                     | 页面路径   | NVARCHAR(500)       | YES  | 公司logo                                                                      |
| OrgIntroduction             | 富文本     | NTEXT/LONG,NVARCHAR | YES  | 企业描述                                                                      |
| ContactName                 | 名称       | NVARCHAR(50)        | YES  | 联系人                                                                        |
| ContactPositionTitle        | 名称       | NVARCHAR(50)        | YES  | 联系人职称                                                                    |
| ContactTelephone            | 编号       | NVARCHAR(50)        | YES  | 联系电话                                                                      |
| ContactPhone                | 编号       | NVARCHAR(50)        | YES  | 联系人手机                                                                    |
| ContactEmail                | 页面路径   | NVARCHAR(500)       | YES  | 联系人邮箱                                                                    |
| ContactQQ                   | 编号       | NVARCHAR(50)        | YES  | 联系人QQ                                                                      |
| ContactMSN                  | 编号       | NVARCHAR(50)        | YES  | 联系人MSN                                                                     |
| ContactFax                  | 编号       | NVARCHAR(50)        | YES  | 编号                                                                          |
| OrgHomepageUrl              | 页面路径   | NVARCHAR(500)       | YES  | 公司主页                                                                      |
| IntegrationCertificateCode  | 编号       | NVARCHAR(50)        | YES  | 系统集成认证号                                                                |
| IntegrationCertificationOrg | 名称       | NVARCHAR(50)        | YES  | 系统集成认证机关                                                              |
| CmmiCertificateCode         | 编号       | NVARCHAR(50)        | YES  | CMMI认证号                                                                    |
| CmmiCertificationOrg        | 名称       | NVARCHAR(50)        | YES  | CMMI认证机关                                                                  |
| CmmiLevelID                 | 外键ID     | CHAR(36)            | YES  | CMMI级别                                                                      |
| ISOCertificateCode          | 编号       | NVARCHAR(50)        | YES  | ISO认证号                                                                     |
| ISOCertificationOrg         | 名称       | NVARCHAR(50)        | YES  | ISO认证机关                                                                   |
| CustomHomePageContents      | 富文本     | NTEXT/LONG NVARCHAR | YES  | 自定义主页内容                                                                |
| IsDeleted                   | 布尔型     | BIT                 | NO   | 布尔型                                                                        |
| IsEnableElearning           | 布尔型     | BIT                 | NO   | 是否启用E-learning在线学习功能                                                |
| SecurityCode                | 文本100    | NVARCHAR(100)       | YES  | 机构授权码                                                                    |
| Status                      | 枚举型     | NVARCHAR(50)        | NO   | 企业状态，使用已定义的枚举变量值                                              |
| ResponsiblePerson           | 名称       | NVARCHAR(50)        | YES  | 负责人                                                                        |
| ResponsiblePersonTel        | 编号       | NVARCHAR(50)        | YES  | 负责人电话                                                                    |
| IsAdvertise                 | 布尔型     | BIT                 | NO   | 是否发布广告                                                                  |
| OrgType                     | 枚举型     | NVARCHAR(50)        | NO   | 机构类型：TrainingOrg培训、University高校、Enterprise企业、SoftwarePark软件园 |
| RegisterUserID              | 外键ID     | CHAR(36)            | YES  | 注册用户的ID                                                                  |
| IsRootOrg                   | 布尔型     | BIT                 | NO   | 是否是根结构机构等级ID,来源于基本资料                                         |
| OrgSystemLevel              | 名称       | NVARCHAR(50)        | YES  | 机构等级名称                                                                  |
| CheckComment                | 简介备注   | NVARCHAR(800)       | YES  | 审核意见                                                                      |
| CheckUserID                 | 外键ID     | CHAR(36)            | YES  | 审核人ID                                                                      |
| CheckUserCName              | 名称       | NVARCHAR(50)        | YES  | 审核人姓名                                                                    |
| IsAutoLogin                 | 布尔型     | BIT                 | NO   | 是否自动登录                                                                  |
| IsRememberPassword          | 布尔型     | BIT                 | NO   | 是否记住密码                                                                  |
| IsSelfDefineLabel           | 布尔型     | BIT                 | NO   | 是否自定义页头页尾                                                            |
| HeaderLabelEName            | 编号       | NVARCHAR(50)        | YES  | 页头标签编码                                                                  |
| FooterLabelEname            | 编号       | NVARCHAR(50)        | YES  | 页尾标签编码                                                                  |
| LoginMasterPage             | 编号       | NVARCHAR(50)        | YES  | 登录母板页编码                                                                |
| RegisterUserCName           | 名称       | NVARCHAR(50)        | YES  | 注册用户中文名                                                                |
| IsRegisterOrg               | 布尔型     | BIT                 | NO   | 是否是注册机构                                                                |
| EmployeeScale               | 富文本     | NTEXT/LONG NVARCHAR | YES  | 员工规模的中文描述                                                            |
| RecommendLevel              | 整型       | INTEGER             | NO   | 推荐级别                                                                      |
| IsFamousOrg                 | 布尔型     | BIT                 | NO   | 是否名企                                                                      |
| ViewCount                   | 整型       | INTEGER             | NO   | 机构被访问次数                                                                |
| IsAllowViewSurveyResult     | 布尔型     | BIT                 | NO   | 是否允许查看调查问卷结果                                                      |
| OrgIntroductionSummary      | 文本2000   | NVARCHAR(2000)      | YES  | 机构文本介绍                                                                  |
| ViewedResumeCount           | 整型       | INTEGER             | NO   | 数量                                                                          |
| ViewTalentLevel             | 外键ID     | CHAR(36)            | YES  | 可查询人才级别                                                                |
| AvailableResumeCount        | 整型       | INTEGER             | NO   | 可以查询的简历人数                                                            |
| ParentOrgID                 | 外键ID     | CHAR(36)            | YES  | 软件园ID,当前机构所属机构ID                                                   |
| ApplicationType             | 枚举型     | NVARCHAR(50)        | NO   | 应用程序类型                                                                  |
| FeeStartDate                | 日期       | DATE                | YES  | 合同开始日期(费用开始时间)                                                    |
| FeeEndDate                  | 日期       | DATE                | YES  | 合同结束日期(费用结束时间)                                                    |
| LastVisitDate               | 日期       | DATE                | YES  | 最近访问日期时间                                                              |
| LastCommunicateDate         | 日期       | DATE                | YES  | 最近沟通时间                                                                  |
| NextCommunicateDate         | 日期       | DATE                | YES  | 下次沟通时间                                                                  |
| SatisfactionRate            | 整型       | INTEGER             | YES  | 满意度                                                                        |
| IntendRate                  | 整型       | INTEGER             | YES  | 意向度                                                                        |
| ExpireDate                  | 日期       | DATE                | YES  | 到期时间                                                                      |
| AppFeareGroupID             | 外键ID     | CHAR(36)            | YES  | 导航组ID                                                                      |
| AppFeareGroupName           | 名称       | NVARCHAR(50)        | YES  | 导航组名称                                                                    |
| AppFeatureGroupType         | 枚举型     | NVARCHAR(50)        | YES  | 导航组类型，FeatureGroupType Free:免费, Base:基础, Standard:标准              |
| YearFee金额/价格            |            | INTEGER             | YES  | 年费                                                                          |
| PlanUserCount               | 整型       | INTEGER             | YES  | 计划使用数量                                                                  |
| ApplyDate                   | 日期       | DATE                | YES  | 申请时间                                                                      |
| IsApprove                   | 布尔型     | BIT                 | YES  | 是否认证                                                                      |
| IsOfficialCustomer          | 布尔型     | BIT                 | YES  | 是否正式客户                                                                  |
| BeOfficialCustomerDate      | 日期       | DATE                | YES  | 转为正式客户时间                                                              |
| IsTemplateOrg               | 布尔型     | BIT                 | YES  | 是否模板机构                                                                  |
| IndustryTemplateID          | 外键ID     | CHAR(36)            | YES  | 行业模板ID                                                                    |
| IndustryTemplateName        | 名称       | NVARCHAR(50)        | YES  | 行业模板名称                                                                  |
| CooperationUpdateDate       | 日期       | DATE                | YES  | 合同更新时间                                                                  |
| MaxUserCount                | 整型       | INTEGER             | YES  | 系统用户最大数量                                                              |
| CurrentUserCount            | 整型       | INTEGER             | YES  | 系统用户当前数量                                                              |
| IsReserveOrg                | 布尔型     | BIT                 | YES  | 是否预留机构                                                                  |
| BusinessLicenseUrl          | 页面路径   | NVARCHAR(500)       | YES  | 代理商营业执照路径                                                            |
| AgentName                   | 名称       | NVARCHAR(50)        | YES  | 代理商名称                                                                    |
| CreateUserID                | 创建人ID   | CHAR(36)            | YES  | 创建人ID                                                                      |
| CreateUserName              | 创建人名称 | NVARCHAR(50)        | YES  | 创建人名称                                                                    |
| CreateDate                  | 创建日期   | DATE                | YES  | 创建日期                                                                      |
| UpdateUserID                | 更新人ID   | CHAR(36)            | YES  | 更新人ID                                                                      |
| UpdateUserName              | 更新人姓名 | NVARCHAR(50)        | YES  | 更新人姓名                                                                    |
| UpdateDate                  | 更新日期   | DATE                | YES  | 更新日期                                                                      |
| RegisterNoURL               |            | NVARCHAR(500)       | YES  | 注册者工号照片URL                                                             |
| RegisterCompanyURL          |            | NVARCHAR(500)       | YES  | 注册者公司照片URL                                                             |
| AuditStatus                 |            | NUMERIC(1,0)        | YES  | 审核注册者上传的照片的状态                                                    |

=======
department

| Attribute/Logical Rolename | Domain     | Datatype      | NULL | Definition                                                      |
| :--:                       | :--:       | :--:          | :--: | :--:                                                            |
| ID(PK)                     | 主键ID     | CHAR(36)      | NO   | 主键ID                                                          |
| OrgID                      | 外键ID     | CHAR(36)      | YES  | 组织单元所在的组织结构ID(或为行业模板ID)                        |
| OUName                     | 标题       | NVARCHAR(100) | NO   | 组织单元名称                                                    |
| OUCode                     | 编号       | NVARCHAR(50)  | NO   | 组织单元编号(内部给每个部门的编号)-不超过２０位                 |
| ParentID                   | 外键ID     | CHAR(36)      | YES  | 父组织单元ID                                                    |
| OURoutingNumber            | 层级编号   | NVARCHAR(50)  | NO   | 组织单元路径，如001.001.002                                     |
| OUManagerID                | 外键ID     | CHAR(36)      | YES  | 部门主管人ID                                                    |
| OUManagerName              | 名称       | NVARCHAR(50)  | YES  | 部门经理姓名                                                    |
| LearningManagerID          | 外键ID     | CHAR(36)      | YES  | 学习主管ID                                                      |
| LearningManagerName        | 名称       | NVARCHAR(50)  | YES  | 学习主管姓名                                                    |
| OUType                     | 枚举型     | NVARCHAR(50)  | NO   | 枚举类型，请参照xxxx枚举                                        |
| IsDeleted                  | 布尔型     | BIT           | NO   | 是否删除                                                        |
| OrderIndex                 | 整型       | INTEGER       | NO   | 部门顺序                                                        |
| Description                | 简介备注   | NVARCHAR(400) | YES  | 部门描述                                                        |
| OUManagerAccount           | 编号       | NVARCHAR(50)  | YES  | 管理员登录帐户                                                  |
| AllowMaxEmployeeCount      | 整型       | INTEGER       | NO   | 数量                                                            |
| OUEmployeeCount            | 整型       | INTEGER       | NO   | 部门/客户/代理商员工人数                                        |
| FullTimeEmployeeCount      | 整型       | INTEGER       | NO   | 全职员工数量                                                    |
| UsingKnowledgPackageName   | 名称       | NVARCHAR(50)  | YES  | 使用学习包名称                                                  |
| UsingKnowledgPackageID     | 外键ID     | CHAR(36)      | YES  | 使用学习包ID                                                    |
| OUUserRoleID               | 外键ID     | CHAR(36)      | YES  | 当前部门员工的默认角色，主要用于客户/代理商所创建用户的角色指定 |
| CurrentSubsidiaryID        | 外键ID     | CHAR(36)      | YES  | 所属分支机构或子公司ID,如果组织结构为支机构或子公司时值为自身ID |
| ThirdSystemID              | 编号       | NVARCHAR(50)  | YES  | 第三方系统ID                                                    |
| OrderTacticsID             | 外键ID     | CHAR(36)      | YES  | 排名策略ID                                                      |
| LowerOUCode                | 机构编号   | CHAR(36)      | NO   | 小写的编号                                                      |
| LowerOuName                | 文本100    | NVARCHAR(100) | YES  | 小写的部门名称                                                  |
| CreateUserID               | 创建人ID   | CHAR(36)      | YES  | 创建人员ID                                                      |
| CreateUserName             | 创建人名称 | NVARCHAR(50)  | YES  | 创建人员姓名                                                    |
| CreateDate                 | 创建日期   | DATE          | YES  | 创建时间                                                        |
| UpdateUserID               | 更新人ID   | CHAR(36)      | YES  | 最后更新人员ID                                                  |
| UpdateUserName             | 更新人姓名 | NVARCHAR(50)  | YES  | 最后更新人员姓名                                                |
| UpdateDate                 | 更新日期   | DATE          | YES  | 最后更新时间                                                    |

=======
org_tree

| 字段        | 类型   | 意义                                |
| :--:        | :--:   | :--:                                |
| node_id     | 字符串 | 节点的ID                            |
| node_type   | Enum   | 节点类型:部门，子公司，项目组，员工 |
| parent_id   | 字符串 | 父亲节点的类型                      |
| parent_type | Enum   | 节点类型:子公司，项目组，部门       |

=======
postition


| Attribute/LogicalRolename | Domain     | Datatype            | NULL | Definition                                        |
| :--:                      | :--:       | :--:                | :--: | :--:                                              |
| ID(PK)                    | 主键ID     | CHAR(36)            | NO   | 主键ID                                            |
| OrgID                     | 外键ID     | CHAR(36)            | NO   | 机构ID                                            |
| PositionNo                | 编号       | NVARCHAR(50)        | NO   | 岗位编号                                          |
| PositionName              | 名称       | NVARCHAR(50)        | NO   | 岗位名称                                          |
| ParentID                  | 外键ID     | CHAR(36)            | YES  | 父节点ID                                          |
| InfoType                  | 枚举型     | NVARCHAR(50)        | NO   | 岗位和岗位目录区分的标示                          |
| SuggestionSalary          | 整型       | INTEGER             | NO   | 建议薪资                                          |
| AlternativePosition       | 名称       | NVARCHAR(50)        | YES  | 可替代岗位                                        |
| IsCanDelete               | 布尔型     | BIT                 | NO   | 是否允许删除                                      |
| IsDeleted                 | 布尔型     | BIT                 | NO   | 删除状态标志                                      |
| IsParentNode              | 布尔型     | BIT                 | NO   | 是否父节点(0:否，1是)                             |
| IsGlobalPosition          | 布尔型     | BIT                 | NO   | 是否是全局职位                                    |
| IsImportantPosition       | 布尔型     | BIT                 | NO   | 是否重要岗位                                      |
| IsSelfDefinition          | 布尔型     | BIT                 | NO   | 是否自定义岗位                                    |
| TotalMustKnowledgeCount   | 整型       | INTEGER             | NO   | 岗位必修知识总数                                  |
| TotalKnowledgeCount       | 整型       | INTEGER             | NO   | 岗位知识总数                                      |
| PositionUserCount         | 整型       | INTEGER             | NO   | 岗位用户数量                                      |
| PromotionPosition         | 简介备注   | NVARCHAR(400)       | YES  | 可晋升/发展岗位                                   |
| PositionResponsibility    | 富文本     | NTEXT/LONG,NVARCHAR | YES  | 岗位职责                                          |
| PositionTraining          | 富文本     | NTEXT/LONG,NVARCHAR | YES  | 岗位培养                                          |
| JobRequire                | 富文本     | NTEXT/LONG,NVARCHAR | YES  | 任职资格                                          |
| CareerDev                 | 富文本     | NTEXT/LONG,NVARCHAR | YES  | 职业发展                                          |
| Description               | 富文本     | NTEXT/LONG,NVARCHAR | YES  | 描述                                              |
| SelfDefinitionContext     | 富文本     | NTEXT/LONG,NVARCHAR | YES  | 自定义岗位内容                                    |
| OrderIndex                | 排序号     | INTEGER             | NO   | 排序索引                                          |
| RoutingNumber             | 层级编号   | NVARCHAR(50)        | NO   | 层级编号(例如：001,001.001,001.002,001.002.001等) |
| ItemCount                 | 整型       | INTEGER             | NO   | 当前分类岗位数量                                  |
| ItemAllCount              | 整型       | INTEGER             | NO   | 当前分类及子分类岗位数量                          |
| LowerPositionNo           | 编号       | NVARCHAR(50)        | NO   | 岗位编号                                          |
| LowerPositionName         | 文本100    | NVARCHAR(200)       | YES  | 小写的岗位名称                                    |
| CreateUserID              | 创建人ID   | CHAR(36)            | YES  | 创建人ID                                          |
| CreateUserName            | 创建人名称 | NVARCHAR(50)        | YES  | 创建人名称                                        |
| CreateDate                | 创建日期   | DATE                | YES  | 创建日期                                          |
| UpdateUserID              | 更新人ID   | CHAR(36)            | YES  | 更新人ID                                          |
| UpdateUserName            | 更新人姓名 | NVARCHAR(50)        | YES  | 更新人姓名                                        |
| UpdateDate                | 更新日期   | DATE                | YES  | 更新日期                                          |


## 一致性分析（待完成）

## 过滤规则，满足服务侧数据过滤

## 业务迁移（待完成）





